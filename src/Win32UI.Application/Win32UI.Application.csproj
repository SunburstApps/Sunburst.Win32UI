<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>netcoreapp1.1</TargetFramework>
  </PropertyGroup>

  <ItemGroup>
    <ProjectReference Include="../Microsoft.GDIPlus/Microsoft.GDIPlus.csproj" />
    <ProjectReference Include="../Win32UI.Aero/Win32UI.Aero.csproj" />
    <ProjectReference Include="../Win32UI.BufferedGraphics/Win32UI.BufferedGraphics.csproj" />
    <ProjectReference Include="../Win32UI.Controls/Win32UI.Controls.csproj" />
    <ProjectReference Include="../Win32UI.Core/Win32UI.Core.csproj" />
    <ProjectReference Include="../Win32UI.CustomControl/Win32UI.CustomControl.csproj" />
    <ProjectReference Include="../Win32UI.Dialogs/Win32UI.Dialogs.csproj" />
    <ProjectReference Include="../Win32UI.EventedWindow/Win32UI.EventedWindow.csproj" />
    <ProjectReference Include="../Win32UI.Graphics/Win32UI.Graphics.csproj" />
    <ProjectReference Include="../Win32UI.ImageList/Win32UI.ImageList.csproj" />
    <ProjectReference Include="../Win32UI.LayoutContainers/Win32UI.LayoutContainers.csproj" />
    <ProjectReference Include="../Win32UI.Menus/Win32UI.Menus.csproj" />
    <ProjectReference Include="../Win32UI.MessageBox/Win32UI.MessageBox.csproj" />
    <ProjectReference Include="../Win32UI.Support/Win32UI.Support.csproj" />
    <ProjectReference Include="../Win32UI.TaskDialogs/Win32UI.TaskDialogs.csproj" />
    <ProjectReference Include="../Win32UI.Theming/Win32UI.Theming.csproj" />
    <ProjectReference Update="@(ProjectReference)" Pack="true" />

    <_BuildContent Include="../build_tools/Win32UI.Build.Tasks/Sunburst.Win32UI.Build.targets" />
    <Content Include="Sunburst.Win32UI.targets" CopyToOutputDirectory="Always" />
  </ItemGroup>

  <ItemGroup Condition="'$(OS)' == 'Windows_NT'">
    <Content Include="../Win32UI.Native/x64/Release/Win32UI.Native.dll">
      <Pack>true</Pack>
      <PackagePath>contentFiles\any\any</PackagePath>
      <CopyToOutputDirectory>Always</CopyToOutputDirectory>
      <Visible>false</Visible>
    </Content>
  </ItemGroup>

  <Target Name="PackBuildAssemblies" BeforeTargets="_GetPackageFiles">
    <MSBuild Projects="../build_tools/Win32UI.Build.Tasks/Win32UI.Build.Tasks.csproj; ../build_tools/Win32UI.Build.NativeResources/Win32UI.Build.NativeResources.csproj" Targets="Build">
      <Output TaskParameter="TargetOutputs" ItemName="_BuildContent" />
    </MSBuild>

    <ItemGroup>
      <Content Include="@(_BuildContent)" Pack="true" PackagePath="build" />
    </ItemGroup>
  </Target>

  <Target Name="CopyOutputsToPrebuiltDirectory" AfterTargets="AfterBuild">
    <PropertyGroup>
      <PrebuiltDirectory Condition="'$(PrebuiltDirectory)' == ''">$(MSBuildThisFileDirectory)/../../bin/prebuilt_dependencies</PrebuiltDirectory>
    </PropertyGroup>

    <ItemGroup>
      <_PrebuiltContent Include="$(TargetPath)" />
      <_PrebuiltContent Include="@(ProjectReference -> '$(OutputPath)%(FileName).dll')" />
      <_PrebuiltContent Include="@(Content)" Condition="'%(Content.CopyToOutputDirectory)' == 'Always' or '%(Content.CopyToOutputDirectory)' == 'PreserveNewest'" />
      <_PrebuiltContent Include="../build_tools/Win32UI.Build.Tasks/Sunburst.Win32UI.Build.targets" />
    </ItemGroup>
    <MSBuild Projects="../build_tools/Win32UI.Build.Tasks/Win32UI.Build.Tasks.csproj; ../build_tools/Win32UI.Build.NativeResources/Win32UI.Build.NativeResources.csproj" Targets="Build">
      <Output TaskParameter="TargetOutputs" ItemName="_PrebuiltContent" />
    </MSBuild>

    <MakeDir Directories="$(PrebuiltDirectory)" />
    <Copy SourceFiles="@(_PrebuiltContent)" DestinationFolder="$(PrebuiltDirectory)" />
  </Target>

  <Import Project="../dir.targets" />
</Project>
