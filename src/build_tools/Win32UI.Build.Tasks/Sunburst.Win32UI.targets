<Project>
  <PropertyGroup>
    <Win32UITasksAssembly Condition="'$(Win32UITasksAssembly)' == ''">$(MSBuildThisFileDirectory)/Win32UI.Build.Tasks.dll</Win32UITasksAssembly>

    <GuiEntryPoint Condition="'$(GuiEntryPoint)' == ''">false</GuiEntryPoint>
  </PropertyGroup>

  <ItemGroup Condition="'$(GuiEntryPont)' == 'true'">
    <SxsDependency Include="Microsoft.Windows.Common-Controls" Version="6.0.0.0" PublicKeyToken="6595b64144ccf1df" />
  </ItemGroup>

  <UsingTask TaskName="GenerateResourceScript" AssemblyFile="$(Win32UITasksAssembly)" />
  <UsingTask TaskName="CompileResourceScript" AssemblyFile="$(Win32UITasksAssembly)" />
  <UsingTask TaskName="MsvcLink" AssemblyFile="$(Win32UITasksAssembly)" />
  <UsingTask TaskName="CopyResourceSegment" AssemblyFile="$(Win32UITasksAssembly)" />
  <UsingTask TaskName="MarkExecutableAsGui" AssemblyFile="$(Win32UITasksAssembly) "/>

  <Target Name="UpdateEntryPointResources" AfterTargets="Build" Condition="'$(OutputType)' == 'Exe'">
    <GenerateResourceScript Icons="@(EntryPointIcon)" ScriptFragments="@(EntryPointResourceScriptFragment)" EmbeddedFiles="@(EntryPointResourceScriptFile)" OutputDirectory="$(IntermediateOutputPath)">
      <Output TaskParameter="ResourceScriptPath" ItemName="_ResourceScript" />
    </GenerateResourceScript>

    <CompileResourceScript ResourceScripts="@(_ResourceScripts)" OutputDirectory="$(IntermediateOutputPath)" ToolPath="$(RCToolPath)">
      <Output TaskParameter="ResourceObjects" ItemName="_ResourceObject" />
    </CompileResourceScript>

    <PropertyGroup>
      <_ResourceLinkOutput>$(IntermediateOutputPath)EntryPointResources.dll</_ResourceLinkOutput>
    </PropertyGroup>

    <MsvcLink Objects="@(_ResourceObject)" SxsManifestFragments="@(SxsManifestFragment)" SxsReferences="@(SxsReference)" UacPrivilegeLevel="$(UacPrivilegeLevel)" OutputFilePath="$(_ResourceLinkOutput)" ToolPath="$(LinkToolPath)" />
    <CopyResourceSegment InputFile="$(_ResourceLinkOutput)" OutputFile="$(TargetDir)$(TargetFileName).exe" />
  </Target>

  <Target Name="MarkEntryPointAsGuiApp" AfterTargets="Build" Condition="'$(GuiEntryPoint)' == 'true' and '$(OutputType)' == 'Exe'">
    <MarkExecutableAsGui ToolPath="$(EditbinToolPath)" Executable="$(TargetDir)$(TargetFileName).exe" />
  </Target>
</Project>
